#!/bin/bash -xeu

rm -rf web_dist
mkdir -p web_dist

pushd api/client
npm i
popd

pushd widget
npm i
npm run build
popd
mv widget/dist web_dist/widget

pushd init
npm i
npm run build
popd
mv init/dist web_dist/widget/dist

pushd docs
npm i
npm run build
popd
mkdir -p web_dist/docs
mv docs/_book web_dist/docs/guide

mkdir -p web_dist/docs/api
cp api/lib/swagger/swagger-ui.html web_dist/docs/api/index.html
sed -i.bak 's/\/swagger\.json/https:\/\/api.snapwallet.io\/swagger\.json/g' web_dist/docs/api/index.html
rm web_dist/docs/api/*.bak
